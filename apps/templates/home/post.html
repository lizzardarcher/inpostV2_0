{% extends "layouts/base.html" %}
{% block title %} –ü–æ—Å—Ç—ã {% endblock %}

{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

    {% if messages %}
        <div class="col-md-6">
            {% for message in messages %}
                <div class="alert alert-success">
                    <button type="button" aria-hidden="true" class="close" data-dismiss="alert" aria-label="Close">
                        <i class="tim-icons icon-simple-remove"></i>
                    </button>
                    <span><b> <i class="fa fa-check"></i> {{ message }}</b></span>
                </div>
            {% endfor %}
        </div>
    {% endif %}
    <div class="row">
        <div class="col-md-8">
            <div class="p-2 m-1">
                <h1> –ú–æ–∏ –ü–æ—Å—Ç—ã </h1>
                <a class="btn btn-primary" href="post_create">+ –î–æ–±–∞–≤–∏—Ç—å –ü–æ—Å—Ç</a>
                <div class="btn-group">
                    <a class="btn btn-secondary text-white" href="template_create">+</a>
                    <a class="btn btn-dark text-white" href="template">–®–∞–±–ª–æ–Ω—ã</a>
                </div>
            </div>
            <div id="accordion-post">
                {% for post in posts %}
                    <div class="card card-chart">
                        <div class="card-header ">

                            {% if post.is_autosend %}
                                <p>–ê–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥ –≤–∫–ª—é—á—ë–Ω ‚úÖ</p>
                            {% else %}
                                <p>–ê–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥ –æ—Ç–∫–ª—é—á–µ–Ω üõë</p>
                            {% endif %}

                            <h5 class="mb-0 row">
                                <button class="col-3 btn btn-link collapsed" data-toggle="collapse"
                                        data-target="#collapse{{ post.id }}"
                                        aria-expanded="true"
                                        aria-controls="collapse{{ post.id }}">
                                    <div class="badge badge-info">{{ post.name }}</div>
                                </button>
                                <div class="col-1 col-lg-5"></div>
                                <button class="btn btn-simple btn-link">
                                    <a class="btn btn-twitter" href="/post_details/{{ post.id }}">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</a>
                                </button>

                            </h5>
                            <hr class="bg-light">
                            <div id="collapse{{ post.id }}" class="collapse" aria-labelledby="heading{{ post.id }}"
                                 data-parent="#accordion-post">
                                <div class="row">
                                    <div class="col-sm-4">
                                        <p class="card-text">{{ post.text|safe }}</p>
                                        {% if references %}
                                            {% for ref in references %}
                                                {% if ref.post == post %}
                                                    <div class="badge badge-dark">
                                                        <p>–°—Å—ã–ª–∫–∞:
                                                            <a class="card-text" href="{{ ref.reference }}">
                                                        <span class="card-text">{{ ref.text }}<i
                                                                class="fa fa-chevron-right"></i></span>
                                                            </a>
                                                        </p>
                                                    </div>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    </div>

                                    <div class="col-sm-4">
                                        {% if post.is_autosend %}
                                            <p>–°–ª–µ–¥—É—é—â–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞:<br> <code>{{ post.send_time_to_channels }}</code></p>
                                            <p>–ó–∞–¥–µ—Ä–∂–∫–∞: <code>{{ post.delay }}</code>(–º–∏–Ω)</p>
                                            <p>–°–ª–µ–¥—É—é—â–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞:<br> <code>{{ post.send_time_to_chats }}</code></p>
                                            <p>–ó–∞–¥–µ—Ä–∂–∫–∞: <code>{{ post.delay_chat }}</code>(–º–∏–Ω)</p>
                                        {% else %}
                                        {% endif %}
                                        {% if post.photo_1 %}
                                            <p>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</p>
                                            <a href="{{ MEDIA_URL }}{{ post.photo_1 }}"><img class="img-thumbnail"
                                                                                             width="75px"
                                                                                             height="60px" src="
                                    {{ MEDIA_URL }}{{ post.photo_1 }}"></a>
                                        {% endif %}
                                        {% if post.photo_2 %}

                                            <a href="{{ MEDIA_URL }}{{ post.photo_2 }}"><img class="img-thumbnail"
                                                                                             width="75px"
                                                                                             height="60px" src="
                                    {{ MEDIA_URL }}{{ post.photo_2 }}"></a>
                                        {% endif %}
                                        {% if post.photo_3 %}

                                            <a href="{{ MEDIA_URL }}{{ post.photo_3 }}"><img class="img-thumbnail"
                                                                                             width="75px"
                                                                                             height="60px" src="
                                    {{ MEDIA_URL }}{{ post.photo_3 }}"></a>
                                        {% endif %}
                                        {% if post.photo_4 %}

                                            <a href="{{ MEDIA_URL }}{{ post.photo_4 }}"><img class="img-thumbnail"
                                                                                             width="75px"
                                                                                             height="60px" src="
                                    {{ MEDIA_URL }}{{ post.photo_4 }}"></a>
                                        {% endif %}
                                        {% if post.photo_5 %}

                                            <a href="{{ MEDIA_URL }}{{ post.photo_5 }}"><img class="img-thumbnail"
                                                                                             width="75px"
                                                                                             height="60px" src="
                                    {{ MEDIA_URL }}{{ post.photo_5 }}"></a>
                                        {% endif %}

                                        <br/>

                                        {% if post.video %}
                                            <p>–í–∏–¥–µ–æ —Ñ–∞–π–ª—ã:</p>
                                            <a href="{{ MEDIA_URL }}{{ post.video }}">{{ post.video }}</a>
                                        {% endif %}
                                        <br/>

                                        {% if post.music %}
                                            <p>–ê—É–¥–∏–æ —Ñ–∞–π–ª—ã:</p>
                                            <a href="{{ MEDIA_URL }}{{ post.music }}">{{ post.music }}</a>
                                        {% endif %}
                                        <br/>

                                        {% if post.document %}
                                            <p>–î–æ–∫—É–º–µ–Ω—Ç—ã:</p>
                                            <a href="{{ MEDIA_URL }}{{ post.document }}">{{ post.document }}</a>
                                        {% endif %}
                                    </div>

                                    <div class="col-sm-4">
                                        <a class="add_sched"
                                           href="?name={{ post.name }}&?id={{ post.id }}">
                                            <button class="btn btn-simple btn-twitter text-center col-12">
                                                –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                                            </button>
                                        </a>
                                        <a href="post_update/{{ post.id }}">
                                            <button class="btn btn-success text-dark text-center col-12">
                                                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                            </button>
                                        </a>
                                        <a href="post_delete/{{ post.id }}">
                                            <button class="btn btn-danger text-dark text-center col-12">
                                                –£–¥–∞–ª–∏—Ç—å
                                            </button>
                                        </a>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div id="cal_mini" class="col-md-4 rounded" style="background-color: #2d223e">
            <br/>
            <div class="col-12" style="display: block">{{ cal_mini|safe }}</div>
        </div>
    </div>

{% endblock content %}

{% block javascripts %}
    <script>
        if (window.innerWidth < 960) {
            const cal_mini = document.getElementById('cal_mini');
            cal_mini.setAttribute('style', 'display: none');
        }
        let month = new Date().getMonth() + 1;
        let year = new Date().getFullYear();
        let day = new Date().getDate();
        // console.log(year, month, day)
        const add_sched = document.getElementsByClassName('add_sched')
        for (i = 0; i <= add_sched.length; i++) {
            let postName = add_sched[i].getAttribute('href')
            add_sched[i].setAttribute('href', `/calendar_event_create/${year}/${month}/${day}/${postName}`)
        }
    </script>
{% endblock javascripts %}
